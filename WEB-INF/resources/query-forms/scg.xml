#macro(getMessage $code)$messageSource.getMessage($code, null, $locale)#end

<form>
  <view>
    <name>SpecimenCollectionGroup</name>
    <caption>#getMessage("visit")</caption>
    <table>CATISSUE_SPECIMEN_COLL_GROUP</table>
    <activeCondition>ACTIVITY_STATUS != 'Disabled'</activeCondition>
    <row>
      <numberField>
        <name>id</name>
        <udn>id</udn>
        <caption>#getMessage("visit_identifier")</caption>
        <column>IDENTIFIER</column>
        <recordUrl>#/object-state-params-resolver?stateName=visit-detail.overview&amp;objectName=visit&amp;key=id&amp;value={{$value}}</recordUrl>
      </numberField>
    </row>
    <row>
      <textField>
        <name>name</name>
        <udn>name</udn>
        <caption>#getMessage("visit_name")</caption>
        <column>NAME</column>
        <recordUrl>#/object-state-params-resolver?stateName=visit-detail.overview&amp;objectName=visit&amp;key=name&amp;value={{$value}}</recordUrl>
      </textField>
    </row>
    <row>
      <dropDown>
        <name>activityStatus</name>
        <udn>activityStatus</udn>
        <caption>#getMessage("visit_activity_status")</caption>
        <column>ACTIVITY_STATUS</column>
        <options>
          <option><value>Active</value></option>
          <option><value>Closed</value></option>
        </options>
      </dropDown>
    </row>
    <row>
      <textField>
        <name>barcode</name>
        <udn>barcode</udn>
        <caption>#getMessage("visit_barcode")</caption>
        <column>BARCODE</column>
      </textField>
    </row>
    <row>
      <siteField>
        <name>site</name>
        <udn>site</udn>
        <caption>#getMessage("visit_site")</caption>
        <column>SITE_ID</column>
        <recordUrl>#/object-state-params-resolver?stateName=site-detail.overview&amp;objectName=site&amp;key=name&amp;value={{$value}}</recordUrl>
      </siteField>
    </row>
    <row>
      <subForm>
        <name>collectionProtocolEvent</name>
        <udn>collectionProtocolEvent</udn>
        <caption>#getMessage("visit_cpe")</caption>
        <table>CATISSUE_COLL_PROT_EVENT</table>
        <foreignKey>IDENTIFIER</foreignKey>
        <parentKey>COLLECTION_PROTOCOL_EVENT_ID</parentKey>
        <row>
          <textField>
            <name>collectionPointLabel</name>
            <udn>collectionPointLabel</udn>
            <caption>#getMessage("visit_cpe_label")</caption>
            <column>COLLECTION_POINT_LABEL</column>
          </textField>
        </row>
        <row>
          <numberField>
            <name>eventPoint</name>
            <udn>eventPoint</udn>
            <caption>#getMessage("visit_cpe_event_point")</caption>
            <column>STUDY_CALENDAR_EVENT_POINT</column>
          </numberField>
        </row>
        <row>
          <dropDown>
            <name>eventPointUnit</name>
            <udn>eventPointUnit</udn>
            <caption>#getMessage("visit_cpe_event_point_unit")</caption>
            <column>EVENT_POINT_UNIT</column>
            <options>
              <option><value>DAYS</value></option>
              <option><value>MONTHS</value></option>
              <option><value>WEEKS</value></option>
              <option><value>YEARS</value></option>
            </options>
          </dropDown>
        </row>
      </subForm>
    </row>
    <row>
      <dropDown>
        <name>collectionStatus</name>
        <udn>collectionStatus</udn>
        <caption>#getMessage("visit_status")</caption>
        <column>COLLECTION_STATUS</column>
        <options>
          <option><value>Pending</value></option>
          <option><value>Complete</value></option>
          <option><value>Not Collected</value></option>
          <option><value>Missed Collection</value></option>
        </options>
      </dropDown>
    </row>
    <row>
      <pvField>
        <name>missedReason</name>
        <udn>missedReason</udn>
        <caption>#getMessage("visit_missed_reason")</caption>
        <column>MISSED_REASON_ID</column>
        <attribute>missed_visit_reason</attribute>
      </pvField>
    </row>
    <row>
      <userField>
        <name>missedBy</name>
        <udn>missedBy</udn>
        <caption>#getMessage("visit_missed_by")</caption>
        <column>MISSED_BY</column>
      </userField>
    </row>
    <row>
      <pvField>
        <name>clinicalDiagnosis</name>
        <udn>clinicalDiagnosis</udn>
        <caption>#getMessage("visit_clinical_diagnosis_deprecated")</caption>
        <multiple>true</multiple>
        <collectionTable>OS_VISIT_CLIN_DIAGNOSES</collectionTable>
        <collectionKey>VISIT_ID</collectionKey>
        <column>CLINICAL_DIAGNOSIS_ID</column>
        <attribute>clinical_diagnosis</attribute>
      </pvField>
    </row>
    <row>
      <pvField>
        <name>clinicalStatus</name>
        <udn>clinicalStatus</udn>
        <caption>#getMessage("visit_clinical_status")</caption>
        <column>CLINICAL_STATUS_ID</column>
        <attribute>clinical_status</attribute>
      </pvField>
    </row>
    <row>
      <pvField>
        <name>cohort</name>
        <udn>cohort</udn>
        <caption>#getMessage("visit_cohort")</caption>
        <column>COHORT_ID</column>
        <attribute>cohort</attribute>
      </pvField>
    </row>
    <row>
      <textField>
        <name>surgicalPathologyNo</name>
        <udn>surgicalPathologyNo</udn>
        <caption>#getMessage("visit_surgical_pathology_number")</caption>
        <column>SURGICAL_PATHOLOGY_NUMBER</column>
        <phi>true</phi>
      </textField>
    </row>
    <row>
      <datePicker>
        <name>collectionDate</name>
        <udn>collectionDate</udn>
        <caption>#getMessage("visit_date")</caption>
        <column>COLLECTION_TIMESTAMP</column>
      </datePicker>
    </row>
    <row>
      <textField>
        <name>spr</name>
        <udn>spr</udn>
        <caption>#getMessage("visit_spr")</caption>
        <column>SPR_NAME</column>
      </textField>
    </row>
    <row>
      <textField>
        <name>comments</name>
        <udn>comments</udn>
        <caption>#getMessage("visit_comments")</caption>
        <column>COMMENTS</column>
      </textField>
    </row>
    <row>
      <datePicker>
        <name>creationTime</name>
        <udn>creationTime</udn>
        <caption>#getMessage("common_creation_time")</caption>
        <column>CREATION_TIME</column>
        <format>MM-dd-yyyy HH:mm</format>
      </datePicker>
    </row>
    <row>
      <userField>
        <name>creator</name>
        <udn>creator</udn>
        <caption>#getMessage("common_creator")</caption>
        <column>CREATOR</column>
      </userField>
    </row>
    <row>
      <datePicker>
        <name>updateTime</name>
        <udn>updateTime</udn>
        <caption>#getMessage("common_update_time")</caption>
        <column>UPDATE_TIME</column>
        <format>MM-dd-yyyy HH:mm</format>
      </datePicker>
    </row>
    <row>
      <userField>
        <name>updater</name>
        <udn>updater</udn>
        <caption>#getMessage("common_updater")</caption>
        <column>UPDATER</column>
      </userField>
    </row>
    <row>
      <subForm>
        <name>clinicalDiagnoses</name>
        <udn>clinicalDiagnoses</udn>
        <caption>#getMessage("visit_clinical_diagnosis")</caption>
        <table>OS_VISIT_CD_VIEW</table>
        <primaryKey>IDENTIFIER</primaryKey>
        <foreignKey>VISIT_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <row>
          <dropDown>
            <name>value</name>
            <udn>value</udn>
            <caption>#getMessage("visit_cd_text")</caption>
            <column>VALUE</column>
            <options>
              <sql>select value from catissue_permissible_value where public_id = 'clinical_diagnosis' order by value</sql>
            </options>
          </dropDown>
          <dropDown>
            <name>code</name>
            <udn>code</udn>
            <caption>#getMessage("visit_cd_code")</caption>
            <column>CODE</column>
            <options>
              <sql>select concept_code from catissue_permissible_value where public_id = 'clinical_diagnosis' and length(concept_code) > 0 order by concept_code</sql>
            </options>
          </dropDown>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>specimens</name>
        <udn>specimens</udn>
        <caption>#getMessage("visit_specimens")</caption>
        <table>CATISSUE_SPECIMEN</table>
        <foreignKey>SPECIMEN_COLLECTION_GROUP_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <pathLink>true</pathLink>
        <row>
          <subForm>
            <name>specimenOrders</name>
            <udn>specimenOrders</udn>
            <caption>#getMessage("visit_specimens_order_items")</caption>
            <table>OS_ORDER_ITEMS</table>
            <foreignKey>SPECIMEN_ID</foreignKey>
            <parentKey>IDENTIFIER</parentKey>
            <row>
              <subForm>
                <name>order</name>
                <udn>order</udn>
                <caption>#getMessage("visit_specimens_order_items_order")</caption>
                <table>OS_ORDERS</table>
                <foreignKey>IDENTIFIER</foreignKey>
                <parentKey>ORDER_ID</parentKey>
              </subForm>
            </row>
          </subForm>
        </row>
        
        <row>
          <subForm>
            <name>specimenShipments</name>
            <udn>specimenShipments</udn>
            <caption>#getMessage("specimen_shipment_items")</caption>
            <table>OS_SHIPMENT_SPECIMENS</table>
            <foreignKey>SPECIMEN_ID</foreignKey>
            <parentKey>IDENTIFIER</parentKey>
           
            <row>
              <subForm>
                <name>shipment</name>
                <udn>shipment</udn>
                <caption>#getMessage("specimen_shipment_items_shipment")</caption>
                <table>OS_SHIPMENTS</table>
                <foreignKey>IDENTIFIER</foreignKey>
                <parentKey>SHIPMENT_ID</parentKey>
              </subForm>
            </row>
          </subForm>
        </row>

        <row>
          <subForm>
            <name>specimenKits</name>
            <udn>specimenKits</udn>
            <caption>#getMessage("specimen_kit_specimens")</caption>
            <table>OS_KIT_SPECIMENS</table>
            <foreignKey>SPECIMEN_ID</foreignKey>
            <parentKey>IDENTIFIER</parentKey>

            <row>
              <subForm>
                <name>specimenKit</name>
                <udn>specimenKit</udn>
                <caption>#getMessage("specimen_kit")</caption>
                <table>OS_SPECIMEN_KITS</table>
                <foreignKey>IDENTIFIER</foreignKey>
                <parentKey>KIT_ID</parentKey>
              </subForm>
            </row>
          </subForm>
        </row>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>customFields</name>
        <udn>customFields</udn>
        <caption>#getMessage("visit_field_extensions")</caption>
        <table>OS_VISIT_CUST_FIELD_EXTNS_VIEW</table>
        <foreignKey>SCG_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>extensions</name>
        <udn>extensions</udn>
        <caption>#getMessage("visit_extensions")</caption>
        <table>SCG_EXTN_RECORDS_VIEW</table>
        <foreignKey>SCG_ID</foreignKey>
        <parentKey>IDENTIFIER</parentKey>
        <pathLink>true</pathLink>
        <extnFkCol>RECORD_ID</extnFkCol>
      </subForm>
    </row>
    <row>
      <subForm>
        <name>participant</name>
        <udn>participant</udn>
        <caption>#getMessage("participant")</caption>
        <table>CPR_VIEW</table>
        <foreignKey>CPR_ID</foreignKey>
        <parentKey>COLLECTION_PROTOCOL_REG_ID</parentKey>
        <pathLink>true</pathLink>
      </subForm>
    </row>

    $querySvc.insertCustomQueryForms('visit')
  </view>
</form>
